#server {
#        listen 80;
#        server_name 127.0.0.1;
#        root /data/styd/basic/web/;
#        index index.html index.htm index.php;
#        location / {
#           if (!-e $request_filename) {
#               rewrite ^/(.*)$ /index.php/$1 last;
#           }
#        }
#        location ~ \.php {
#            fastcgi_pass localhost:9000;
#            fastcgi_index index.php;
#            fastcgi_split_path_info ^(.+\.php)(.*)$;
#            fastcgi_param PATH_INFO $fastcgi_path_info;
#            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#            include fastcgi_params;
#        }
#
#        error_page   500 502 503 504  /50x.html;
#        location = /50x.html {
#            root   html;
#        }
#}

#server {
#    listen       80;
#    server_name localhost;
#
#    location / {
#        proxy_pass http://workspace:9501;
#        proxy_set_header   Host    $host;
#        proxy_set_header   X-Real-IP   $remote_addr;
#        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
#        proxy_set_header   X-Request-Id $request_id;
#    }
#}


server {
        listen 80;
        server_name localhost;
        root /data/dly/dlbbs/upload;
        #root /data/dly/dlbbsdev/upload;
        #server_name dev.dalongyun.com;
        #root /data/dly/discuz/upload;
        index index.html index.htm indexs.php;

        location ^~/_api/ {
            proxy_set_header   Host    $host;
            proxy_set_header   X-Real-IP   $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header   X-Request-Id $request_id;

            rewrite ^/_api/(.*)$ /$1 break;
            proxy_pass http://workspace72:9501/_api;
        }

        location / {
           if (!-e $request_filename) {
               rewrite ^/(.*)$ /index.php/$1 last;
           }
        }
        location ~ \.php {
            fastcgi_pass workspace56:9000;
            fastcgi_index index.php;
            fastcgi_split_path_info ^(.+\.php)(.*)$;
            fastcgi_param PATH_INFO $fastcgi_path_info;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            include fastcgi_params;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
}
